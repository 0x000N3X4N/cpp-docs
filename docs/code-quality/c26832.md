---
title: Warning C26832
description: "Describes the Microsoft C/C++ code analysis warning C26832, its causes, and how to address it."
ms.date: 03/06/2023
f1_keywords: ["C26832", "ALLOCATION_POTENTIAL_OVERFLOW_AFTER_CAST"]
helpviewer_keywords: ["C26832"]
---
# Warning C26832

> Allocation size is the result of a narrowing conversion that could result in overflow

## Remarks

Checks for an allocation whose size may be the result of a numerical overflow. This check is targeted to find the following code pattern:

```cpp
void* SmallAlloc(int);

void foo(unsigned short i, unsigned short j)
{
    unsigned short size = i + j;
    
    int* p = (int*)SmallAlloc(size); // Warning: C26832
    p[i] = 5;
}
```

In `i + j`, `i` and `j` are promoted to integers and the result of the addition is stored into a temporary integer. This integer is implicitly casted to `unsigned short` before the value is stored to `size`. The result of this cast might overflow. So, `SmallAlloc` might end up returning a buffer smaller than expected. Future accesses like `p[i]` are out of bounds. These code patterns can result in remote code execution vulnerabilities.

Common allocation functions like `new`, `malloc`, and `VirtualAlloc` are recognized. The check also tries to recognize custom allocator functions by case insensitive search for the `alloc` substring in the function name.

Our analysis engine's numerical solver have some limitations reasoning about numerical overflows. As a result, this check uses some heuristics and sometimes fails to recognize that certain checks can prevent overflows.
Usually, checking for a reasonable bound on the allocation should work. 

This warning is available in Visual Studio 2022 version 17.7 and later versions.
## Example

To fix the previous code example, make sure `i+j` can't overflow. For example:

```cpp
void *SmallAlloc(int);

void foo(unsigned short i, unsigned short j)
{
    if (i > 100 || j > 100)
        return;

    unsigned short size = i + j;
    
    int* p = (int*)SmallAlloc(size);
    p[i] = 5;
}
```

## See also

[C26831](c26831.md)\
[C26833](c26833.md)