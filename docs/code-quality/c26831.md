---
title: Warning C26831
description: "Describes the Microsoft C/C++ code analysis warning C26831, its causes, and how to address it."
ms.date: 03/06/2023
f1_keywords: ["C26831", "ALLOCATION_POTENTIAL_OVERFLOW"]
helpviewer_keywords: ["C26831"]
---
# Warning C26831

> Allocation size might be the result of a numerical overflow

## Remarks

Checks for allocations that have potentially overflown values as their sizes. This check is targeted to find the following code pattern:

```cpp
void *SmallAlloc(int);

void foo(int i, int j)
{
    int* p = (int*)SmallAlloc(i + j); // Warning: C26831
    p[i] = 5;
}
```

In case `i+j` overflows, `SmallAlloc` will return a buffer that is smaller than expected. As a result, future accesses to the buffer like `p[i]` will be out of bounds. These code patterns can result in remote code execution vulnerabilities.

Our analysis engine's numerical solver have some limitations reasoning about numerical overflows. As a result, this check is using some heuristics and can sometimes be a bit noisy.

# Example

To fix the code example above, make sure `i+j` cannot overflow. For example:

```cpp
void *SmallAlloc(int);

void foo(int i, int j)
{
    if (i < 0 || j < 0 )
        return;
    
    if (i > 100 || j > 100)
        return;

    int* p = (int*)SmallAlloc(i + j);
    p[i] = 5;
}
```