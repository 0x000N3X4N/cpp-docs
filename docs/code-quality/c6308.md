---
title: C6308
description: "Understand the causes of Microsoft C/C++ code analysis warning C6308, and learn how to fix them."
ms.date: 10/23/2020
ms.topic: reference
f1_keywords: ["C6308"]
helpviewer_keywords: ["C6308"]
ms.assetid: 1162cd96-9037-4576-9858-0c8361a12559
---
# C6308

**Warning C6308: Memory Reallocation Leak (REALLOCLEAK)**\
Example output:
> 'realloc' may return null pointer: assigning a null pointer to '\**parameter-name*', which is passed as an argument to 'realloc', will cause the original memory block to be leaked

## Description

This warning indicates a memory leak due to the unsafe use of a reallocation function. Heap reallocation functions don't free the passed buffer if reallocation is unsuccessful. To correct the issue, assign the result of the reallocation function to a temporary location, and then replace the original pointer after successful reallocation.

## Example

The following sample code generates this warning. This issue stems from the assignment of x to the return value from realloc. If realloc fails and returns a null pointer, then x will fail to be freed:

```cpp
#include <malloc.h>
#include <windows.h>

void f( )
{
  char *x;
  x = (char *) malloc(10);
  if (x != NULL)
  {
    x = (char *) realloc(x, 512);
    // code...
    free(x);
  }
}
```

To resolve the issue, you can create a temporary variable to store the return status of realloc. This change allows you to free the previously allocated memory safely if realloc fails:

```cpp
#include <malloc.h>
#include <windows.h>

void f()
{
  char *x, *tmp;
  x = (char *) malloc(10);
  if (x != NULL)
  {
    tmp = (char *) realloc(x,512);
    if (tmp != NULL)
    {
      x = tmp;
    }
    // code...
    free(x);
  }
}
```

This warning might generate noise if there's a live alias to the buffer-to-be-reallocated at the time of the assignment of the result of the reallocation function.

To avoid these kinds of issues altogether, you can use the mechanisms that are provided by the C++ Standard Template Library (STL). These include [shared_ptr](../standard-library/shared-ptr-class.md), [unique_ptr](../standard-library/unique-ptr-class.md), and [vector](../standard-library/vector.md). For more information, see [Smart Pointers](../cpp/smart-pointers-modern-cpp.md) and [C++ Standard Library](../standard-library/cpp-standard-library-reference.md).

## See also

[C6014](../code-quality/c6014.md)
